# üöó Car Rental API

API REST moderne pour la gestion de locations de v√©hicules. Solution compl√®te permettant la gestion des utilisateurs, du parc automobile et des r√©servations.

## üìã Table des mati√®res

- [Technologies](#technologies)
- [Pr√©requis](#pr√©requis)
- [Installation](#installation)
- [Configuration](#configuration)
- [Base de donn√©es](#base-de-donn√©es)
- [D√©marrage](#d√©marrage)
- [Documentation API](#documentation-api)
- [Tests](#tests)
- [Contribution](#contribution)

## üõ† Technologies

- **Runtime** : Node.js ‚â• 18
- **Framework** : Express.js
- **ORM** : Prisma
- **Base de donn√©es** : PostgreSQL
- **Authentification** : JWT (JSON Web Tokens)
- **Langage** : JavaScript/TypeScript

## ‚ö° Pr√©requis

Assurez-vous d'avoir install√© les √©l√©ments suivants :

- [Node.js](https://nodejs.org/) version 18 ou sup√©rieure
- [PostgreSQL](https://www.postgresql.org/) (local ou Docker)
- [npm](https://www.npmjs.com/) ou [yarn](https://yarnpkg.com/)

## üì¶ Installation

### 1. Cloner le d√©p√¥t

```bash
git clone <repository-url>
cd car-rental-api
```

### 2. Installer les d√©pendances

```bash
npm install
```

## ‚öôÔ∏è Configuration

### Variables d'environnement

Cr√©ez un fichier `.env` √† la racine du projet avec les param√®tres suivants :

```env
# Database
DATABASE_URL="postgresql://myuser:mypassword@localhost:5432/mydb?schema=public"

# Security
JWT_SECRET=your_super_secret_key_change_this_in_production

# Server
PORT=3000
NODE_ENV=development
```

> ‚ö†Ô∏è **Important** : Modifiez les valeurs par d√©faut, notamment `JWT_SECRET`, avant le d√©ploiement en production.

## üóÑÔ∏è Base de donn√©es

### Configuration PostgreSQL

#### M√©thode 1 : Installation locale

```bash
# Se connecter √† PostgreSQL
psql -U postgres

# Cr√©er la base de donn√©es et l'utilisateur
CREATE DATABASE mydb;
CREATE USER myuser WITH ENCRYPTED PASSWORD 'mypassword';
GRANT ALL PRIVILEGES ON DATABASE mydb TO myuser;

# Configurer le sch√©ma
DROP SCHEMA public CASCADE;
CREATE SCHEMA public;
GRANT ALL ON SCHEMA public TO myuser;
GRANT ALL ON SCHEMA public TO postgres;

# Quitter psql
\q
```

#### M√©thode 2 : Docker (recommand√©)

```bash
docker run --name car-rental-postgres \
  -e POSTGRES_USER=myuser \
  -e POSTGRES_PASSWORD=mypassword \
  -e POSTGRES_DB=mydb \
  -p 5432:5432 \
  -d postgres:15-alpine
```

### Migrations Prisma

Appliquez les migrations pour cr√©er les tables :

```bash
npx prisma migrate dev --name init
```

Apr√®s la cr√©ation des tables, ex√©cutez :

```bash
npm run seed
```

pour ins√©rer des fausses donn√©es de d√©veloppement.

<!-- Ajout : section seed -->

### Seed ‚Äî peupler la base avec des donn√©es de test

Un script de seed est fourni dans `prisma/seed.js`. Il supprime les donn√©es existantes puis cr√©e des utilisateurs, des voitures et des locations d'exemple.

√âtapes :

1. V√©rifier que `DATABASE_URL` est correctement d√©fini dans `.env`.
2. G√©n√©rer le client Prisma (si n√©cessaire) :

```bash
npx prisma generate
```

3. Lancer le seed :

```bash
node prisma/seed.js
```

Optionnel : ajouter un script npm dans `package.json` :

```json
"scripts": {
  "seed": "node prisma/seed.js"
}
```

puis ex√©cuter :

```bash
npm run seed
```

Remarque : le seed r√©initialise les tables concern√©es (deleteMany) ‚Äî utiliser en environnement de d√©veloppement uniquement.

### V√©rification

```bash
# Se connecter √† la base
psql -U myuser -d mydb

# Lister les tables
\dt

# Tables attendues : User, Car, Rental, _prisma_migrations
```

## üöÄ D√©marrage

### Mode d√©veloppement

```bash
npm run dev
```

Le serveur d√©marre sur `http://localhost:3000`

### Test rapide

```bash
curl http://localhost:3000
# R√©ponse attendue : "üöó API en route !"
```

## üìö Documentation API

### Authentification

| M√©thode | Endpoint         | Description                            | Auth requise |
| ------- | ---------------- | -------------------------------------- | ------------ |
| POST    | `/auth/register` | Inscription d'un nouvel utilisateur    | Non          |
| POST    | `/auth/login`    | Connexion et r√©cup√©ration du token JWT | Non          |

#### Exemple : Inscription

```bash
curl -X POST http://localhost:3000/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "john@example.com",
    "password": "SecurePass123",
    "name": "John Doe"
  }'
```

#### Exemple : Connexion

```bash
curl -X POST http://localhost:3000/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "john@example.com",
    "password": "SecurePass123"
  }'
```

### Gestion des voitures

| M√©thode | Endpoint    | Description                           | Auth requise |
| ------- | ----------- | ------------------------------------- | ------------ |
| GET     | `/cars`     | Liste toutes les voitures disponibles | Oui          |
| POST    | `/newcars`  | Ajouter une nouvelle voiture          | Oui          |
| GET     | `/cars/:id` | D√©tails d'une voiture sp√©cifique      | Oui          |

#### Exemple : Ajouter une voiture

```bash
curl -X POST http://localhost:3000/newcars \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <YOUR_JWT_TOKEN>" \
  -d '{
    "brand": "Tesla",
    "model": "Model 3",
    "year": 2024,
    "pricePerDay": 89.99,
    "available": true
  }'
```

### Gestion des locations

| M√©thode | Endpoint       | Description                                 | Auth requise |
| ------- | -------------- | ------------------------------------------- | ------------ |
| GET     | `/rentals`     | Liste toutes les locations de l'utilisateur | Oui          |
| POST    | `/rentals`     | Cr√©er une nouvelle location                 | Oui          |
| GET     | `/rentals/:id` | D√©tails d'une location sp√©cifique           | Oui          |

#### Exemple : Cr√©er une location

```bash
curl -X POST http://localhost:3000/rentals \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <YOUR_JWT_TOKEN>" \
  -d '{
    "carId": 1,
    "startDate": "2025-11-01",
    "endDate": "2025-11-07"
  }'
```

### Authentification des requ√™tes

Pour les endpoints prot√©g√©s, incluez le token JWT dans le header :

```
Authorization: Bearer <YOUR_JWT_TOKEN>
```

## üß™ Tests avec Postman / Insomnia

### Routes prot√©g√©es

Les endpoints suivants n√©cessitent une authentification JWT :

- `GET /cars` - Liste des voitures
- `POST /newcars` - Ajout d'une voiture
- `GET /rentals` - Liste des locations
- `POST /rentals` - Cr√©ation d'une location

### Configuration dans Postman

#### √âtape 1 : Obtenir le token JWT

1. Cr√©ez une requ√™te `POST` vers `http://localhost:3000/auth/login`
2. Dans l'onglet **Body** > **raw** > **JSON**, ajoutez :

```json
{
  "email": "john@example.com",
  "password": "SecurePass123"
}
```

3. Envoyez la requ√™te et copiez le token JWT de la r√©ponse

#### √âtape 2 : Configurer l'authentification

**M√©thode 1 : Ajouter le header manuellement**

1. Cr√©ez une nouvelle requ√™te `GET` vers `http://localhost:3000/cars`
2. Allez dans l'onglet **Headers**
3. Ajoutez un nouveau header :
   - **Key** : `Authorization`
   - **Value** : `Bearer <VOTRE_TOKEN_JWT>`
4. Envoyez la requ√™te

**M√©thode 2 : Utiliser une variable d'environnement (recommand√©)**

1. Cliquez sur l'ic√¥ne ‚öôÔ∏è en haut √† droite > **Environments**
2. Cr√©ez un nouvel environnement nomm√© `Car Rental Local`
3. Ajoutez une variable :
   - **Variable** : `token`
   - **Initial Value** : (laissez vide)
   - **Current Value** : `<VOTRE_TOKEN_JWT>`
4. S√©lectionnez l'environnement `Car Rental Local` dans le menu d√©roulant
5. Dans vos requ√™tes, utilisez `{{token}}` dans le header Authorization :
   - **Key** : `Authorization`
   - **Value** : `Bearer {{token}}`

#### √âtape 3 : Exemple complet avec GET /cars

```
M√©thode : GET
URL : http://localhost:3000/cars

Headers :
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Key             ‚îÇ Value                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Authorization   ‚îÇ Bearer {{token}}     ‚îÇ
‚îÇ Content-Type    ‚îÇ application/json     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**R√©ponse attendue (200 OK) :**

```json
[
  {
    "id": 1,
    "brand": "Tesla",
    "model": "Model 3",
    "year": 2024,
    "pricePerDay": 89.99,
    "available": true
  }
]
```

### Configuration dans Insomnia

1. Cr√©ez une nouvelle requ√™te
2. Dans l'onglet **Auth** > s√©lectionnez **Bearer Token**
3. Collez votre token JWT dans le champ **Token**
4. Insomnia ajoutera automatiquement le header `Authorization: Bearer <token>`

### üí° Astuces

- **Automatiser la r√©cup√©ration du token** : Dans Postman, utilisez les **Tests** scripts pour extraire automatiquement le token de la r√©ponse login et le stocker dans une variable d'environnement :

  ```javascript
  pm.test("Save token", function () {
    var jsonData = pm.response.json();
    pm.environment.set("token", jsonData.token);
  });
  ```

- **V√©rifier l'expiration** : Si vous obtenez une erreur `401 Unauthorized`, votre token a peut-√™tre expir√©. Reconnectez-vous pour en obtenir un nouveau.

## üß™ Tests automatis√©s

```bash
# Tests unitaires
npm test

# Tests avec couverture
npm run test:coverage

# Tests d'int√©gration
npm run test:integration
```

## üìÅ Structure du projet

```
car-rental-api/
‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îú‚îÄ‚îÄ schema.prisma
‚îÇ   ‚îî‚îÄ‚îÄ migrations/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îú‚îÄ‚îÄ middlewares/
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îú‚îÄ‚îÄ .env
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ README.md
```

## ü§ù Contribution

Les contributions sont les bienvenues ! Merci de suivre ces √©tapes :

1. Fork le projet
2. Cr√©er une branche feature (`git checkout -b feature/AmazingFeature`)
3. Commit vos changements (`git commit -m 'Add some AmazingFeature'`)
4. Push vers la branche (`git push origin feature/AmazingFeature`)
5. Ouvrir une Pull Request

## üìù License

Ce projet est sous licence MIT. Voir le fichier `LICENSE` pour plus de d√©tails.

## üìß Contact

Pour toute question ou suggestion :

- Email zak : contact@car-rental-api.com

---

D√©velopp√© avec ‚ù§Ô∏è par zak et youness
